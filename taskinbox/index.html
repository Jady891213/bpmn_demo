<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPMN/CMMN æŠ¥è¡¨ä»»åŠ¡ä¸­å¿ƒ - æµ…è‰²ä¸»é¢˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* å¼•å…¥ Inter å­—ä½“å¹¶è®¾ç½®èƒŒæ™¯è‰² */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Gray-100 Light Background */
            color: #1f2937; /* Gray-800 Default Text Color */
        }
        /* é’ˆå¯¹å³ä¾§è¯¦æƒ…æ åœ¨å°å±å¹•ä¸Šè¿›è¡Œå…¨å±å¤„ç† */
        .task-detail-container.hidden-mobile {
            display: none;
        }
        @media (min-width: 768px) {
            .task-detail-container.hidden-mobile {
                display: flex; /* ç¡®ä¿åœ¨æ¡Œé¢ç«¯æ˜¯ flex å¸ƒå±€ */
            }
            /* ç¡®ä¿å³æ çš„é¡¶éƒ¨æ“ä½œåŒºåœ¨æ»šåŠ¨æ—¶ä¿æŒå¯è§ */
            .detail-header-sticky {
                position: sticky;
                top: 0;
                z-index: 10;
            }
        }
        /* Excel æ ·å¼æ¨¡æ‹Ÿ - é€‚åº”æµ…è‰²ä¸»é¢˜ */
        .excel-like-table th, .excel-like-table td {
            border: 1px solid #d1d5db; /* Gray-300 */
            padding: 8px;
            white-space: nowrap;
        }
        .excel-like-table th {
            background-color: #e5e7eb; /* Gray-200 */
            color: #1f2937; /* Gray-800 */
            font-weight: 600;
        }
        .excel-like-table td {
            background-color: #ffffff; /* White for cell background */
            color: #374151; /* Gray-700 */
        }
        .excel-like-table {
            border-collapse: collapse;
            width: 100%;
        }
        /* ç¡®ä¿åˆå¹¶åçš„ä¸»æ åœ¨æ”¶èµ·çŠ¶æ€ä¸‹åªæ˜¾ç¤ºå›¾æ ‡ */
        .task-list-collapsed {
            width: 3rem !important; /* w-12 */
        }
        .task-list-expanded {
            width: 24rem !important; /* w-96 */
        }
        /* è¡¨å•å¡ç‰‡æ ·å¼ */
        .form-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="h-screen overflow-hidden">

    <div id="app" class="h-full flex">

        <div id="task-list-container" class="task-list-expanded flex flex-col w-full md:w-96 bg-white border-r border-gray-200 overflow-y-auto transition-[width] duration-300 ease-in-out flex-shrink-0">

            <div id="task-list-header" class="sticky top-0 p-4 bg-white z-20 shadow-md border-b border-gray-200 flex-shrink-0">

                <div class="flex justify-between items-center mb-4" id="task-list-controls">
                    <h1 id="main-column-title" class="text-xl font-bold text-indigo-600 transition-opacity duration-150">ä»»åŠ¡ä¸æµç¨‹ä¸­å¿ƒ</h1>

                    <button id="toggle-main-column" onclick="toggleMainColumn()" class="p-1 rounded-full text-gray-400 hover:text-indigo-600 transition duration-150 flex-shrink-0 hidden md:block">
                        <svg id="collapse-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
                    </button>
                </div>

                <div id="task-list-filters" class="transition-opacity duration-300">

                    <div class="mb-4">
                        <label for="process-filter" class="text-xs font-medium uppercase text-gray-500 block mb-1">æŒ‰æµç¨‹/æ¡ˆä¾‹ç­›é€‰</label>
                        <select id="process-filter" onchange="setProcessFilter(this.value)" class="w-full p-2 rounded-lg bg-gray-100 border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 text-sm text-gray-800">
                            </select>
                    </div>

                    <div class="flex space-x-2 mb-3">
                        <button id="tab-pending" onclick="setTaskFilter('Pending')" class="flex-1 p-2 rounded-lg bg-indigo-600 text-white font-semibold text-sm transition duration-150 shadow-md">å¾…åŠä»»åŠ¡</button>
                        <button id="tab-completed" onclick="setTaskFilter('Completed')" class="flex-1 p-2 rounded-lg bg-gray-200 text-gray-600 font-semibold text-sm hover:bg-gray-300 transition duration-150">å·²åŠä»»åŠ¡</button>
                    </div>

                    <input type="text" id="task-search" oninput="renderTaskList()" placeholder="æœç´¢ä»»åŠ¡æ ‡é¢˜ / æµç¨‹åç§°..." class="w-full p-2 rounded-lg bg-gray-100 border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 text-sm placeholder-gray-500 text-gray-800">
                </div>
            </div>

            <div id="tasks-container" class="flex-grow transition-opacity duration-300">
                </div>
        </div>

        <div id="task-detail" class="task-detail-container flex-grow flex-col bg-gray-50 overflow-y-auto relative transition-all duration-300 ease-in-out hidden-mobile">
            <button id="back-to-inbox" class="md:hidden absolute top-4 left-4 p-2 rounded-full bg-indigo-600 hover:bg-indigo-700 text-white z-30 shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            </button>

            <div id="detail-content" class="flex flex-col h-full">
                <div class="flex-grow flex flex-col">
                    <div class="text-center py-16 text-gray-500" id="initial-message">
                        <svg class="w-12 h-12 mx-auto mb-3 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-17 4v10a2 2 0 002 2h12a2 2 0 002-2v-10"></path></svg>
                        <p class="text-xl font-medium">è¯·ä»å·¦æ é€‰æ‹©ä¸€ä¸ªä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚</p>
                        <p class="text-sm">ä»»åŠ¡è¯¦æƒ…ã€æŠ¥è¡¨åˆ—è¡¨å’Œ Excel æŠ¥è¡¨è¯¦æƒ…å°†åœ¨æ­¤å¤„åŠ¨æ€åŠ è½½ã€‚</p>
                    </div>
                    <div id="task-data-view" class="h-full w-full hidden flex-col">
                        <div id="detail-header" class="detail-header-sticky p-6 bg-white rounded-b-lg shadow-lg border-b border-gray-200 flex justify-between items-start">

                            <div class="flex-grow pr-4">
                                <h2 id="task-title-display" class="text-2xl font-extrabold text-gray-900"></h2>
                                <p id="task-desc-display" class="text-sm text-gray-500 mt-1"></p>
                            </div>

                            <div class="flex flex-col sm:flex-row gap-2 mt-1 flex-shrink-0">
                                <button onclick="handleTaskAction(activeTaskId, 'Complete')" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-200 flex items-center text-sm">
                                    <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    å®Œæˆ/æäº¤
                                </button>
                                <button onclick="handleTaskAction(activeTaskId, 'Reject')" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-200 flex items-center text-sm">
                                    <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    æ‹’ç»/é€€å›
                                </button>
                                <button onclick="handleTaskAction(activeTaskId, 'Delegate')" class="px-4 py-2 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-400 transition duration-200 flex items-center text-sm">
                                    å§”æ´¾
                                </button>
                            </div>
                        </div>

                        <div id="detail-split-container" class="flex flex-grow overflow-hidden pt-4 px-6 pb-6">
                            <div id="report-nav" class="w-1/4 max-w-xs bg-white p-4 rounded-l-lg overflow-y-auto border-r border-gray-200 shadow-inner flex-shrink-0">
                                <h3 class="text-lg font-semibold mb-3 text-indigo-600">æŠ¥è¡¨åˆ—è¡¨</h3>

                                <div class="flex space-x-2 mb-4">
                                    <select id="year-filter" class="w-1/2 p-2 rounded-lg bg-gray-100 text-sm border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 text-gray-800">
                                        <option value="2026">2026 å¹´</option>
                                        <option value="2025" selected>2025 å¹´</option>
                                    </select>
                                    <select id="month-filter" class="w-1/2 p-2 rounded-lg bg-gray-100 text-sm border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 text-gray-800">
                                        <option value="12">12 æœˆ</option>
                                        <option value="11" selected>11 æœˆ</option>
                                        <option value="10">10 æœˆ</option>
                                    </select>
                                </div>
                                <div id="report-list-container" class="space-y-2">
                                    </div>
                            </div>

                            <div id="report-detail" class="flex-grow bg-white p-6 overflow-auto shadow-lg rounded-r-lg">
                                <h3 id="report-detail-title" class="text-lg font-semibold mb-4 text-gray-900">è¯·åœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªæŠ¥è¡¨</h3>
                                <div id="excel-editor" class="text-sm">
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // æ¨¡æ‹Ÿä»»åŠ¡æ•°æ®
        const mockTasks = [
            // Report Task
            { id: 1, title: "Q4 é¢„ç®—å¤æ ¸åŠæŠ¥è¡¨å¡«å†™", process: "è´¢åŠ¡é¢„ç®— V2", applicant: "ææ˜", dueDate: "2025-11-17", priority: "High", type: "Report", status: "Pending", content: "è¯·å¤æ ¸å¹¶æ‰¹å‡†2026å¹´åº¦éƒ¨é—¨é¢„ç®—è‰æ¡ˆï¼Œéœ€å¡«å†™ä¸‰ä¸ªå…³è”æŠ¥è¡¨ã€‚", icon: 'ğŸ’¸',
              reports: [
                  { id: 'R1', name: 'éƒ¨é—¨è´¹ç”¨é¢„ç®—è¡¨', data: 'Data for R1', active: true },
                  { id: 'R2', name: 'èµ„æœ¬æ”¯å‡ºç”³è¯·è¡¨', data: 'Data for R2', active: false },
                  { id: 'R3', name: 'å‘˜å·¥è–ªé…¬é¢„æµ‹è¡¨', data: 'Data for R3', active: false },
                  { id: 'R4', name: 'å·®æ—…æŠ¥é”€æ±‡æ€»è¡¨', data: 'Data for R4', active: false },
                  { id: 'R5', name: 'å¸‚åœºæ¨å¹¿è´¹ç”¨æŠ¥è¡¨', data: 'Data for R5', active: false }
              ]
            },
            // DataEntry Task (éæŠ¥è¡¨ä»»åŠ¡, å•ä¸€è¡¨å•)
            { id: 2, title: "ITèµ„äº§é‡‡è´­é…ç½®è¡¨å½•å…¥", process: "é‡‡è´­è¯·æ±‚", applicant: "å¼ å", dueDate: "2025-11-19", priority: "Medium", type: "DataEntry", status: "Pending", content: "éœ€è¦å½•å…¥ä¸‰å°æ–°æœåŠ¡å™¨çš„è¯¦ç»†é…ç½®å’Œä¾›åº”å•†ä¿¡æ¯ã€‚éæŠ¥è¡¨ä»»åŠ¡ã€‚", icon: 'ğŸ’»', reports: [] },
            // Checklist Task (éæŠ¥è¡¨ä»»åŠ¡, ç®€å•å®¡æ ¸)
            { id: 3, title: "æ–°å‘˜å·¥å…¥èŒææ–™æ¸…å•ç¡®è®¤", process: "äººåŠ›èµ„æºå…¥èŒæµç¨‹", applicant: "ç‹èŠ³", dueDate: "2025-11-28", priority: "High", type: "Checklist", status: "Pending", content: "ç¡®è®¤æ–°å‘˜å·¥ï¼ˆé™ˆæ‚¦ï¼‰æ‰€æœ‰å…¥èŒææ–™å·²æäº¤å’Œå½’æ¡£ã€‚å·¥å·ï¼šHR801ã€‚", icon: 'ğŸ‘¶', reports: [] },
            // Review Task (éæŠ¥è¡¨ä»»åŠ¡, æ–‡æœ¬è¾“å…¥)
            { id: 4, title: "åˆåŒæ¡æ¬¾ä¿®è®¢åé¦ˆ", process: "æ³•å¾‹å®¡æŸ¥", applicant: "èµµä¸½", dueDate: "2025-12-01", priority: "Low", type: "Review", status: "Pending", content: "é’ˆå¯¹é”€å”®åˆåŒæ¨¡æ¿çš„ç¬¬5æ¡è¿›è¡Œæ³•å¾‹å®¡æŸ¥å¹¶æå‡ºä¿®æ”¹æ„è§ã€‚", icon: 'ğŸ“', reports: [] },
            // Report Task
            { id: 5, title: "ç³»ç»Ÿæ•…éšœæŠ¥å‘Šå¤„ç†åŠå¡«å†™", process: "ç³»ç»Ÿäº‹ä»¶å¤„ç†", applicant: "ç³»ç»Ÿç®¡ç†å‘˜", dueDate: "2025-12-05", priority: "High", type: "Report", status: "Pending", content: "SaaSå¹³å°æ ¸å¿ƒæœåŠ¡å®•æœºï¼Œè¯·ç«‹å³å¼€å§‹æ•…éšœå¤„ç†æµç¨‹å¹¶è®°å½•æ‰€æœ‰æ­¥éª¤ï¼Œéœ€å¡«å†™äº‹æ•…æŠ¥å‘Šè¡¨ã€‚", icon: 'ğŸš¨',
              reports: [{ id: 'R6', name: 'äº‹æ•…åŸå› åˆ†ææŠ¥å‘Š', data: 'Data for R6', active: true }, { id: 'R7', name: 'ä¿®å¤æ“ä½œæ—¥å¿—', data: 'Data for R7', active: false }] },
            // Completed Task
            { id: 6, title: "2025 Q3 ç»©æ•ˆè¯„ä¼°æäº¤", process: "äººåŠ›èµ„æºç»©æ•ˆç®¡ç†", applicant: "ææ˜", dueDate: "2025-10-30", priority: "Medium", type: "Review", status: "Completed", content: "å·²å®ŒæˆQ3ç»©æ•ˆè¯„ä¼°çš„æäº¤ã€‚", icon: 'â­', reports: [] },
        ];

        let activeTaskId = null;
        let currentFilter = 'Pending';
        let currentProcessFilter = 'All'; // æµç¨‹ç­›é€‰çŠ¶æ€ï¼Œåˆå§‹é»˜è®¤å€¼ä¸º 'All'
        let isCollapsed = false; // æŠ˜å çŠ¶æ€

        const tasksContainer = document.getElementById('tasks-container');
        const detailContainer = document.getElementById('task-detail');
        const detailContent = document.getElementById('detail-content');
        const initialMessage = document.getElementById('initial-message');
        const taskDataView = document.getElementById('task-data-view');
        const backButton = document.getElementById('back-to-inbox');

        // æ–°å¢/ä¿®æ”¹ DOM å¼•ç”¨
        const taskListContainer = document.getElementById('task-list-container');
        const collapseIcon = document.getElementById('collapse-icon');
        const mainColumnTitle = document.getElementById('main-column-title');
        const taskListFilters = document.getElementById('task-list-filters');
        const taskListControls = document.getElementById('task-list-controls');
        const taskListHeader = document.getElementById('task-list-header');
        const processFilterSelect = document.getElementById('process-filter');
        const taskSearchInput = document.getElementById('task-search');

        // æ–°å¢ DOM å¼•ç”¨
        const reportNav = document.getElementById('report-nav'); // æŠ¥è¡¨å¯¼èˆªæ 
        const reportDetail = document.getElementById('report-detail'); // æŠ¥è¡¨/è¡¨å•è¯¦æƒ…æ 
        const detailSplitContainer = document.getElementById('detail-split-container'); // è¯¦æƒ…åˆ†å‰²å®¹å™¨

        const TODAY = new Date().setHours(0, 0, 0, 0);

        /**
         * åˆ‡æ¢ä¸»æ çš„æ”¶èµ·/å±•å¼€çŠ¶æ€
         */
        function toggleMainColumn() {
            isCollapsed = !isCollapsed;

            if (isCollapsed) {
                // 1. ä¸»æ : æ”¶ç¼©åˆ°è¾¹æ¡å®½åº¦ w-12
                taskListContainer.classList.remove('task-list-expanded');
                taskListContainer.classList.add('task-list-collapsed');

                // 2. éšè—å†…å®¹ (æ ‡é¢˜, ç­›é€‰å™¨, ä»»åŠ¡åˆ—è¡¨)
                mainColumnTitle.classList.add('hidden'); // éšè—æ ‡é¢˜
                taskListFilters.classList.add('hidden'); // éšè—ç­›é€‰å™¨
                tasksContainer.classList.add('opacity-0', 'pointer-events-none'); // éšè—åˆ—è¡¨

                // 3. è°ƒæ•´æ§åˆ¶åŒºå¸ƒå±€: ä»…æ˜¾ç¤ºæŒ‰é’®å¹¶å±…ä¸­ (ä¿®å¤ç‚¹å‡»åæ— æ³•æ‰“å¼€çš„é—®é¢˜)
                taskListControls.classList.remove('justify-between', 'mb-4');
                taskListControls.classList.add('justify-center');

                // 4. è°ƒæ•´å¤´éƒ¨ padding
                taskListHeader.classList.remove('p-4');
                taskListHeader.classList.add('py-4', 'px-3');

                // 5. æ›´æ”¹å›¾æ ‡ä¸ºå±•å¼€ (Chevron Right)
                collapseIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path>`;

            } else {
                // 1. ä¸»æ : æ¢å¤å®½åº¦ w-96
                taskListContainer.classList.remove('task-list-collapsed');
                taskListContainer.classList.add('task-list-expanded');

                // 2. æ˜¾ç¤ºå†…å®¹
                mainColumnTitle.classList.remove('hidden');
                taskListFilters.classList.remove('hidden');
                tasksContainer.classList.remove('opacity-0', 'pointer-events-none');

                // 3. æ¢å¤æ§åˆ¶åŒºå¸ƒå±€
                taskListControls.classList.add('justify-between', 'mb-4');
                taskListControls.classList.remove('justify-center');

                // 4. æ¢å¤å¤´éƒ¨ padding
                taskListHeader.classList.add('p-4');
                taskListHeader.classList.remove('py-4', 'px-3');

                // 5. æ›´æ”¹å›¾æ ‡ä¸ºæ”¶èµ· (Chevron Left)
                collapseIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path>`;
            }
        }

        /**
         * å¡«å……æµç¨‹ç­›é€‰ä¸‹æ‹‰æ¡†
         */
        function populateProcessFilter() {
            const processes = mockTasks.reduce((acc, task) => {
                if (!acc.includes(task.process)) {
                    acc.push(task.process);
                }
                return acc;
            }, []);

            // æ€»æ˜¯å°† 'All' é€‰é¡¹ä½œä¸ºç¬¬ä¸€ä¸ªï¼Œå¹¶è®¡ç®—å½“å‰çŠ¶æ€ä¸‹çš„æ€»æ•°
            const totalCount = mockTasks.filter(t => t.status === currentFilter).length;
            let optionsHtml = `<option value="All">æ‰€æœ‰æµç¨‹/æ¡ˆä¾‹ (${totalCount})</option>`;

            processes.sort().forEach(process => {
                // ä»…æ˜¾ç¤ºå½“å‰çŠ¶æ€ä¸‹æœ‰ä»»åŠ¡çš„æµç¨‹
                const count = mockTasks.filter(t => t.status === currentFilter && t.process === process).length;
                if (count > 0) {
                     optionsHtml += `<option value="${process}">${process} (${count})</option>`;
                }
            });

            processFilterSelect.innerHTML = optionsHtml;

            // ç¡®ä¿ dropdown é€‰ä¸­å½“å‰ç­›é€‰å€¼
            // ä¿®å¤: ç¡®ä¿ currentProcessFilter æœ‰å€¼ï¼Œå¦‚æœæ²¡æœ‰ï¼ˆä¾‹å¦‚åœ¨ setTaskFilter ä¸­é‡ç½®äº†ï¼‰ï¼Œåˆ™è®¾ç½®ä¸º 'All'
            if (!processFilterSelect.querySelector(`option[value="${currentProcessFilter}"]`)) {
                 currentProcessFilter = 'All';
            }
            processFilterSelect.value = currentProcessFilter;
        }

        /**
         * è®¾ç½®æµç¨‹ç­›é€‰çŠ¶æ€
         */
        function setProcessFilter(process) {
            currentProcessFilter = process;
            renderTaskList();
        }


        /**
         * æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
         */
        function renderTaskList() {
            tasksContainer.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨
            const searchTerm = taskSearchInput.value.toLowerCase();

            // 1. è¿‡æ»¤ä»»åŠ¡: çŠ¶æ€ + æµç¨‹ + æœç´¢
            const filteredTasks = mockTasks.filter(t =>
                t.status === currentFilter &&
                (currentProcessFilter === 'All' || t.process === currentProcessFilter) &&
                (t.title.toLowerCase().includes(searchTerm) || t.process.toLowerCase().includes(searchTerm))
            );

            // 2. ä»»åŠ¡åˆ†ç»„é€»è¾‘ (ä»…å¯¹ Pending ä»»åŠ¡è¿›è¡Œé€¾æœŸ/æˆªæ­¢åˆ†ç»„)
            const overdueTasks = [];
            const upcomingTasks = [];
            const standardTasks = [];
            const completedTasks = [];

            filteredTasks.forEach(task => {
                if (task.status === 'Pending') {
                    const dueDate = new Date(task.dueDate).setHours(0, 0, 0, 0);
                    const diffDays = (dueDate - TODAY) / (1000 * 60 * 60 * 24);

                    if (diffDays < 0) {
                        overdueTasks.push(task);
                    } else if (diffDays <= 3) { // 3å¤©å†…æˆªæ­¢ç®—ä½œå³å°†æˆªæ­¢
                        upcomingTasks.push(task);
                    } else {
                        standardTasks.push(task);
                    }
                } else {
                    completedTasks.push(task);
                }
            });

            const renderGroup = (tasks, title, isUrgent) => {
                if (tasks.length === 0) return '';
                let groupHtml = `<div class="p-2 pt-4 text-xs font-semibold uppercase ${isUrgent ? 'text-red-600' : 'text-gray-500'}">${title} (${tasks.length})</div>`;
                groupHtml += tasks.map(task => createTaskItemHtml(task, isUrgent)).join('');
                return groupHtml;
            };

            // 2. æ¸²æŸ“åˆ†ç»„ (æ ¹æ®å½“å‰ filter æ¸²æŸ“ä¸åŒçš„åˆ†ç»„)
            let allTasksHtml = '';
            if (currentFilter === 'Pending') {
                allTasksHtml += renderGroup(overdueTasks, 'ğŸš¨ å·²é€¾æœŸä»»åŠ¡', true);
                allTasksHtml += renderGroup(upcomingTasks, 'â³ æœ€è¿‘æˆªæ­¢ä»»åŠ¡ (3å¤©å†…)', true);
                allTasksHtml += renderGroup(standardTasks, 'å¾…å¤„ç†ä»»åŠ¡', false);
            } else { // Completed
                 allTasksHtml += renderGroup(completedTasks, 'âœ… å·²åŠä»»åŠ¡', false);
            }

            tasksContainer.innerHTML = allTasksHtml;

            // 3. é€‰ä¸­çŠ¶æ€å¤„ç†
            if (activeTaskId) {
                const activeItem = document.getElementById(`task-${activeTaskId}`);
                if (activeItem) {
                    // æµ…è‰²ä¸»é¢˜ä¸‹çš„é€‰ä¸­æ ·å¼
                    activeItem.classList.add('bg-indigo-100', 'border-l-4', 'border-indigo-600');
                }
            }

            // 4. æ›´æ–°æµç¨‹å’ŒçŠ¶æ€ç­›é€‰å™¨ä¸Šçš„è®¡æ•°
            populateProcessFilter(); // é‡æ–°è®¡ç®—æµç¨‹åˆ†ç»„çš„å¾…åŠæ•°é‡
            updateTabCounts();
        }

        /**
         * æ›´æ–°å¾…åŠ/å·²åŠ Tab ä¸Šçš„ä»»åŠ¡è®¡æ•°
         */
        function updateTabCounts() {
            const pendingCount = mockTasks.filter(t => t.status === 'Pending').length;
            const completedCount = mockTasks.filter(t => t.status === 'Completed').length;

            document.getElementById('tab-pending').textContent = `å¾…åŠä»»åŠ¡ (${pendingCount})`;
            document.getElementById('tab-completed').textContent = `å·²åŠä»»åŠ¡ (${completedCount})`;
        }


        /**
         * åˆ›å»ºå•ä¸ªä»»åŠ¡é¡¹çš„ HTML
         * æ›´æ”¹: å‹ç¼©è¡Œé«˜ (p-4 -> p-3)ï¼Œå°†ä¼˜å…ˆçº§å’Œæ—¥æœŸæ”¾åˆ°æµç¨‹åŒä¸€è¡Œ
         */
        function createTaskItemHtml(task, isUrgent) {
            const dueDate = new Date(task.dueDate);
            const formattedDate = `${dueDate.getMonth() + 1}-${dueDate.getDate()}`;

            // ä¼˜å…ˆçº§é¢œè‰²æ˜ å°„
            const priorityColor = task.priority === 'High' ? 'bg-red-500' :
                                 task.priority === 'Medium' ? 'bg-amber-500' : 'bg-blue-500';

            // æµ…è‰²ä¸»é¢˜ä¸‹çš„æ ·å¼è°ƒæ•´
            const itemClass = `p-3 border-b border-gray-200 cursor-pointer hover:bg-indigo-50 transition duration-150 ${isUrgent ? 'bg-red-50 hover:bg-red-100' : 'bg-white'}`;
            const processTextColor = isUrgent ? 'text-red-700' : 'text-gray-500';
            const dateTextColor = isUrgent ? 'text-red-500 font-bold' : 'text-gray-500';


            return `
                <div id="task-${task.id}" class="${itemClass}" onclick="selectTask(${task.id})">
                    <div class="flex items-center mb-1">
                        <span class="text-lg mr-2 flex-shrink-0">${task.icon}</span>
                        <h3 class="font-semibold text-sm truncate text-gray-800">${task.title}</h3>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <p class="text-xs ${processTextColor} truncate mr-2 flex-grow">æµç¨‹ï¼š${task.process}</p>
                        <div class="flex items-center space-x-2 text-xs flex-shrink-0">
                            <span class="text-xs ${priorityColor} text-white px-1.5 py-0.5 rounded-full flex-shrink-0">${task.priority}</span>
                            <span class="flex items-center ${dateTextColor} flex-shrink-0">
                                <svg class="w-3 h-3 mr-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                ${formattedDate}
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- æ–°å¢/ä¿®æ”¹ï¼šè¡¨å•å’ŒæŠ¥è¡¨é€»è¾‘ ---

        /**
         * æ ¹æ®æŠ¥è¡¨IDæ¨¡æ‹Ÿæ¸²æŸ“ Excel æ ·å¼æŠ¥è¡¨å†…å®¹
         */
        function renderExcelReport(reportId) {
            const editorDiv = document.getElementById('excel-editor');

            // æ¨¡æ‹Ÿ Excel æŠ¥è¡¨æ•°æ®
            const tableData = [
                ['é¡¹ç›®', '11æœˆé¢„ç®— (K)', '11æœˆå®é™… (K)', '12æœˆé¢„æµ‹ (K)', 'å¤‡æ³¨'],
                ['äººåŠ›æˆæœ¬', 200, 205, 210, 'äººå‘˜å˜åŠ¨'],
                ['è½¯ä»¶è®¸å¯è´¹', 50, 48, 50, 'å·²æ”¯ä»˜'],
                ['å·®æ—…è´¹ç”¨', 30, 35, 40, 'å¾…æŠ¥é”€'],
                ['åŠå…¬è€—æ', 10, 8, 12, ''],
                ['æ€»è®¡', 290, 296, 312, '']
            ];

            let tableHtml = '<div class="overflow-x-auto"><table class="excel-like-table">';

            tableData.forEach((row, rowIndex) => {
                tableHtml += '<tr>';
                row.forEach((cell, colIndex) => {
                    if (rowIndex === 0) {
                        tableHtml += `<th>${cell}</th>`; // è¡¨å¤´
                    } else {
                        // æ¨¡æ‹Ÿå¯ç¼–è¾‘å•å…ƒæ ¼ (åªæœ‰â€œ12æœˆé¢„æµ‹â€å’Œâ€œå¤‡æ³¨â€å¯ç¼–è¾‘)
                        const isEditable = rowIndex < tableData.length - 1 && (colIndex === 3 || colIndex === 4);
                        const isTitle = colIndex === 0 && rowIndex > 0;

                        if (isTitle) {
                           tableHtml += `<th>${cell}</th>`; // ç¬¬ä¸€åˆ—ä½œä¸ºæ ‡é¢˜
                        } else {
                            // æµ…è‰²ä¸»é¢˜ä¸‹çš„å¯ç¼–è¾‘å•å…ƒæ ¼æ ·å¼
                            const editableClass = isEditable ? 'contenteditable="true" class="bg-gray-100 hover:bg-gray-200 transition duration-100"' : 'class="bg-white text-gray-700"';
                            tableHtml += `<td ${editableClass}>${cell}</td>`;
                        }
                    }
                });
                tableHtml += '</tr>';
            });

            tableHtml += '</table></div>';
            editorDiv.innerHTML = tableHtml;
        }

        /**
         * æ–°å¢ï¼šæ ¹æ®ä»»åŠ¡ç±»å‹æ¨¡æ‹Ÿæ¸²æŸ“æ™®é€šè¡¨å•å†…å®¹
         */
        function renderFormContent(task) {
            const editorDiv = document.getElementById('excel-editor');
            let formHtml = `<div class="form-card space-y-6">`;

            // ä»»åŠ¡è¯´æ˜/å†…å®¹
            formHtml += `
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ä»»åŠ¡æè¿°</label>
                    <div class="p-3 bg-gray-50 border border-gray-200 rounded-md text-gray-600 text-sm">${task.content}</div>
                </div>
            `;

            // æ ¹æ®ä»»åŠ¡æ ‡é¢˜å’Œç±»å‹ç”Ÿæˆæ¨¡æ‹Ÿå­—æ®µ
            if (task.type === 'DataEntry') {
                // ITèµ„äº§é‡‡è´­é…ç½®è¡¨å½•å…¥
                formHtml += `
                    <div>
                        <label for="vendor" class="block text-sm font-medium text-gray-700">ä¾›åº”å•†åç§°</label>
                        <input type="text" id="vendor" value="XXç§‘æŠ€ï¼ˆåŒ—äº¬ï¼‰æœ‰é™å…¬å¸" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="server_model" class="block text-sm font-medium text-gray-700">æœåŠ¡å™¨å‹å·/é…ç½®</label>
                        <textarea id="server_model" rows="4" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="E.g., 3x Dell PowerEdge R750, 1TB RAM, 10x1.2TB SSD">${task.content.includes("ä¸‰å°æ–°æœåŠ¡å™¨") ? "3x Dell PowerEdge R750\n1TB RAM\n10x1.2TB SSD" : task.content}</textarea>
                    </div>
                    <div class="flex space-x-4">
                        <div class="flex-1">
                            <label for="total_cost" class="block text-sm font-medium text-gray-700">æ€»é‡‡è´­æˆæœ¬ (RMB)</label>
                            <input type="number" id="total_cost" value="125000" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="flex-1">
                            <label for="install_date" class="block text-sm font-medium text-gray-700">é¢„è®¡åˆ°è´§/å®‰è£…æ—¥æœŸ</label>
                            <input type="date" id="install_date" value="2025-12-10" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>
                `;
            } else if (task.type === 'Checklist') {
                 // æ–°å‘˜å·¥å…¥èŒææ–™æ¸…å•ç¡®è®¤
                 formHtml += `
                    <div>
                        <label class="block text-sm font-medium text-gray-700">å…¥èŒææ–™æ¸…å•å®¡æ ¸</label>
                        <div class="mt-2 space-y-2">
                            <div class="flex items-center"><input type="checkbox" checked class="form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded"><label class="ml-2 text-sm text-gray-700">èº«ä»½è¯/æŠ¤ç…§å¤å°ä»¶</label></div>
                            <div class="flex items-center"><input type="checkbox" checked class="form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded"><label class="ml-2 text-sm text-gray-700">å­¦å†/å­¦ä½è¯ä¹¦</label></div>
                            <div class="flex items-center"><input type="checkbox" class="form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded"><label class="ml-2 text-sm text-gray-700">å‰å…¬å¸ç¦»èŒè¯æ˜ï¼ˆ**å¾…è¡¥äº¤**ï¼‰</label></div>
                            <div class="flex items-center"><input type="checkbox" checked class="form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded"><label class="ml-2 text-sm text-gray-700">ä¸ªäººä¿¡æ¯é‡‡é›†è¡¨</label></div>
                        </div>
                    </div>
                    <div>
                        <label for="checklist_comment" class="block text-sm font-medium text-gray-700">å®¡æ ¸å¤‡æ³¨</label>
                        <textarea id="checklist_comment" rows="2" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="å¦‚æœ‰é—æ¼æˆ–éœ€è¦è·Ÿè¿›çš„äº‹é¡¹ï¼Œè¯·åœ¨æ­¤è¯´æ˜ã€‚">å·²é€šçŸ¥HRè·Ÿè¿›ç¦»èŒè¯æ˜ã€‚</textarea>
                    </div>
                 `;
            } else if (task.type === 'Review') {
                // åˆåŒæ¡æ¬¾ä¿®è®¢åé¦ˆ
                formHtml += `
                    <div>
                        <label for="review_section" class="block text-sm font-medium text-gray-700">å®¡æŸ¥å¯¹è±¡</label>
                        <p class="text-gray-900 font-semibold mt-1">é”€å”®åˆåŒæ¨¡æ¿ï¼šç¬¬5æ¡ - è¿çº¦è´£ä»»</p>
                    </div>
                    <div>
                        <label for="review_opinion" class="block text-sm font-medium text-gray-700">å®¡æŸ¥æ„è§/ä¿®è®¢è‰æ¡ˆ</label>
                        <textarea id="review_opinion" rows="6" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="è¯·è¯¦ç»†è¯´æ˜æ‚¨çš„å®¡æŸ¥æ„è§æˆ–æå‡ºå…·ä½“çš„ä¿®è®¢å»ºè®®ã€‚">å»ºè®®å°†è¿çº¦é‡‘ä¸Šé™ä»åˆåŒæ€»ä»·çš„10%æé«˜è‡³15%ï¼Œä»¥æ›´å¥½åœ°è¦†ç›–æ½œåœ¨æŸå¤±ã€‚å¦ï¼Œè¡¥å……ä¸å¯æŠ—åŠ›æ¡æ¬¾çš„è§¦å‘æ¡ä»¶è¯´æ˜ã€‚</textarea>
                    </div>
                `;
            }

            formHtml += '</div>'; // close form-card
            editorDiv.innerHTML = formHtml;
        }

        /**
         * æ¸²æŸ“æŠ¥è¡¨å¯¼èˆªåˆ—è¡¨
         */
        function renderReportNavigation(task) {
            const reportNavContainer = document.getElementById('report-list-container');
            reportNavContainer.innerHTML = '';

            // æŠ¥è¡¨ä»»åŠ¡ï¼šæ˜¾ç¤ºæŠ¥è¡¨åˆ—è¡¨
            if (task.reports && task.reports.length > 0) {
                // 1. ç¡®ä¿æŠ¥è¡¨å¯¼èˆªå’Œè¯¦æƒ…åŒºåŸŸä»¥åˆ†æ å½¢å¼æ˜¾ç¤º
                reportNav.classList.remove('hidden', 'w-full', 'rounded-lg');
                reportNav.classList.add('w-1/4', 'max-w-xs', 'rounded-l-lg', 'border-r');
                reportDetail.classList.remove('rounded-lg');
                reportDetail.classList.add('rounded-r-lg');
                detailSplitContainer.classList.add('flex-row');

                // 2. æ¸²æŸ“æŠ¥è¡¨æŒ‰é’®
                task.reports.forEach(report => {
                    const button = document.createElement('button');
                    // æµ…è‰²ä¸»é¢˜ä¸‹çš„æŠ¥è¡¨å¯¼èˆªæ ·å¼
                    button.className = `w-full text-left p-2 rounded-lg text-sm transition duration-150 truncate ${report.active ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`;
                    button.textContent = report.name;
                    button.onclick = () => selectReport(task.id, report.id, report.name);
                    reportNavContainer.appendChild(button);
                });
            } else {
                // éæŠ¥è¡¨ä»»åŠ¡ï¼šéšè—æŠ¥è¡¨å¯¼èˆª
                reportNav.classList.add('hidden');

                // ç¡®ä¿è¯¦æƒ…åŒºåŸŸç‹¬å æ•´ä¸ªç©ºé—´
                reportDetail.classList.remove('rounded-r-lg');
                reportDetail.classList.add('rounded-lg');
                detailSplitContainer.classList.remove('flex-row');
            }
        }

        /**
         * é€‰ä¸­æŠ¥è¡¨
         */
        function selectReport(taskId, reportId, reportName) {
            const task = mockTasks.find(t => t.id === taskId);
             if (task && task.reports) {
                 // 1. æ›´æ–°é€‰ä¸­çŠ¶æ€æ•°æ®
                 task.reports.forEach(r => r.active = (r.id === reportId));

                 // 2. æ›´æ–°å³ä¾§æ ‡é¢˜å’Œå†…å®¹
                 document.getElementById('report-detail-title').textContent = `ğŸ“ ${reportName} - å¡«å†™/ä¿®æ”¹`;
                 renderExcelReport(reportId); // æ¨¡æ‹ŸåŠ è½½ Excel å†…å®¹

                 // 3. é‡æ–°æ¸²æŸ“å¯¼èˆªä»¥æ›´æ–°é€‰ä¸­çŠ¶æ€
                 renderReportNavigation(task);
             }
        }


        /**
         * æ¸²æŸ“ä»»åŠ¡è¯¦æƒ… (å³æ )
         * @param {object} task - é€‰ä¸­çš„ä»»åŠ¡å¯¹è±¡
         */
        function renderTaskDetail(task) {
            activeTaskId = task.id; // ç¡®ä¿ activeTaskId å§‹ç»ˆä¸å½“å‰æ¸²æŸ“çš„ä»»åŠ¡åŒ¹é…
            initialMessage.classList.add('hidden'); // éšè—åˆå§‹æç¤º
            taskDataView.classList.remove('hidden');

            // 1. é¡¶éƒ¨æ“ä½œåŒº
            document.getElementById('task-title-display').textContent = task.title;
            document.getElementById('task-desc-display').innerHTML = `
                <span class="text-indigo-600 font-medium">${task.process}</span> |
                ç”³è¯·äºº: <span class="text-gray-800">${task.applicant}</span> |
                æˆªæ­¢æ—¥æœŸ: <span class="${new Date(task.dueDate) < TODAY ? 'text-red-500 font-bold' : 'text-green-600'}">${task.dueDate}</span>
            `;

            // 2. æŠ¥è¡¨å¯¼èˆªå’Œè¯¦æƒ… split
            renderReportNavigation(task);

            if (task.type === 'Report' && task.reports && task.reports.length > 0) {
                // æŠ¥è¡¨ä»»åŠ¡ï¼šåŠ è½½ç¬¬ä¸€ä¸ªæŠ¥è¡¨å†…å®¹
                document.getElementById('report-detail-title').textContent = 'è¯·åœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªæŠ¥è¡¨';
                const activeReport = task.reports.find(r => r.active);
                if (activeReport) {
                    selectReport(task.id, activeReport.id, activeReport.name);
                } else {
                    // å¦‚æœæ²¡æœ‰é»˜è®¤æ¿€æ´»çš„ï¼Œåˆ™æ¿€æ´»ç¬¬ä¸€ä¸ªå¹¶æ¸²æŸ“
                    task.reports[0].active = true;
                    selectReport(task.id, task.reports[0].id, task.reports[0].name);
                }
            } else {
                // éæŠ¥è¡¨ä»»åŠ¡ï¼šæ¸²æŸ“è¡¨å•å†…å®¹
                document.getElementById('report-detail-title').textContent = `ğŸ“‹ ä»»åŠ¡è¡¨å•: ${task.type}`;
                renderFormContent(task); // æ¸²æŸ“æ¨¡æ‹Ÿè¡¨å•
            }

            // ç¡®ä¿è¯¦æƒ…å†…å®¹æ˜¯å¯è§çš„
            detailContent.classList.remove('hidden');
        }

        /**
         * è®¾ç½®ä»»åŠ¡è¿‡æ»¤å™¨ (å¾…åŠ/å·²åŠ)
         */
        function setTaskFilter(filter) {
            if (currentFilter === filter) {
                // å¦‚æœæ˜¯åˆ‡æ¢åˆ°å½“å‰çŠ¶æ€ï¼Œåˆ™åªæ‰§è¡Œä¸€æ¬¡æ¸²æŸ“å’Œæ›´æ–°è®¡æ•°
                renderTaskList();
                return;
            }

            currentFilter = filter;
            currentProcessFilter = 'All'; // åˆ‡æ¢ Tab æ—¶é‡ç½®æµç¨‹ç­›é€‰

            // ç§»é™¤æ‰€æœ‰ tab çš„ active æ ·å¼ (æµ…è‰²ä¸»é¢˜)
            document.getElementById('tab-pending').classList.remove('bg-indigo-600', 'text-white');
            document.getElementById('tab-pending').classList.add('bg-gray-200', 'text-gray-600', 'hover:bg-gray-300');
            document.getElementById('tab-completed').classList.remove('bg-indigo-600', 'text-white');
            document.getElementById('tab-completed').classList.add('bg-gray-200', 'text-gray-600', 'hover:bg-gray-300');

            // æ·»åŠ å½“å‰é€‰ä¸­ tab çš„ active æ ·å¼
            document.getElementById(`tab-${filter.toLowerCase()}`).classList.remove('bg-gray-200', 'text-gray-600', 'hover:bg-gray-300');
            document.getElementById(`tab-${filter.toLowerCase()}`).classList.add('bg-indigo-600', 'text-white');

            // é‡ç½®æµç¨‹ç­›é€‰å™¨åˆ° 'All' é€‰é¡¹
            processFilterSelect.value = 'All';
            taskSearchInput.value = '';

            renderTaskList();
        }


        /**
         * é€‰æ‹©ä»»åŠ¡å¹¶åˆ‡æ¢è¯¦æƒ…ç•Œé¢
         */
        function selectTask(taskId) {
            const task = mockTasks.find(t => t.id === taskId);
            if (!task) return;

            // 1. ç§»é™¤æ—§ä»»åŠ¡çš„é€‰ä¸­çŠ¶æ€
            if (activeTaskId) {
                const oldItem = document.getElementById(`task-${activeTaskId}`);
                if (oldItem) {
                    oldItem.classList.remove('bg-indigo-100', 'border-l-4', 'border-indigo-600');
                    // æ¢å¤æ—§ä»»åŠ¡çš„é»˜è®¤æˆ–ç´§æ€¥èƒŒæ™¯è‰²
                    const oldTask = mockTasks.find(t => t.id === activeTaskId);
                    if (oldTask) {
                        const isOverdueOrUpcoming = new Date(oldTask.dueDate).setHours(0, 0, 0, 0) < TODAY || (new Date(oldTask.dueDate).setHours(0, 0, 0, 0) - TODAY) / (1000 * 60 * 60 * 24) <= 3;
                        oldItem.classList.remove(isOverdueOrUpcoming ? 'bg-red-100' : 'bg-indigo-50'); // ç§»é™¤ hover çŠ¶æ€èƒŒæ™¯
                        oldItem.classList.add(isOverdueOrUpcoming ? 'bg-red-50' : 'bg-white'); // æ¢å¤éé€‰ä¸­çŠ¶æ€èƒŒæ™¯
                    }
                }
            }

            // 2. æ·»åŠ æ–°ä»»åŠ¡çš„é€‰ä¸­çŠ¶æ€
            const newItem = document.getElementById(`task-${taskId}`);
            if (newItem) {
                // ç§»é™¤åŸæœ‰çš„èƒŒæ™¯è‰²ï¼Œæ·»åŠ é€‰ä¸­è‰²
                newItem.classList.remove('bg-white', 'bg-red-50', 'hover:bg-indigo-50', 'hover:bg-red-100');
                newItem.classList.add('bg-indigo-100', 'border-l-4', 'border-indigo-600');
            }

            // 3. æ¸²æŸ“è¯¦æƒ…
            renderTaskDetail(task);

            // 4. ç§»åŠ¨ç«¯åˆ‡æ¢ï¼šæ˜¾ç¤ºè¯¦æƒ…æ ï¼Œéšè—åˆ—è¡¨æ 
            if (window.innerWidth < 768) {
                detailContainer.classList.remove('hidden-mobile');
                taskListContainer.classList.add('hidden');
                backButton.onclick = () => {
                    detailContainer.classList.add('hidden-mobile');
                    taskListContainer.classList.remove('hidden');
                };
            }
        }

        // åˆå§‹åŠ è½½
        document.addEventListener('DOMContentLoaded', () => {
            // ç¡®ä¿å¾…åŠ Tab é€‰ä¸­
            setTaskFilter('Pending');
            // é¦–æ¬¡æ¸²æŸ“åˆ—è¡¨
            renderTaskList();
            // ç»‘å®šè¿”å›æŒ‰é’®äº‹ä»¶ (æ¡Œé¢ç«¯éšè—)
            backButton.onclick = () => {
                detailContainer.classList.add('hidden-mobile');
                taskListContainer.classList.remove('hidden');
            };
        });

        function handleTaskAction(taskId, action) {
             alert(`ä»»åŠ¡ ID: ${taskId}ï¼Œæ‰§è¡Œæ“ä½œ: ${action}`);
             // æ¨¡æ‹Ÿä»»åŠ¡å®Œæˆ/æ‹’ç»åï¼Œåº”è¯¥ä»åˆ—è¡¨ä¸­ç§»é™¤
             if (action === 'Complete') {
                 const taskIndex = mockTasks.findIndex(t => t.id === taskId);
                 if (taskIndex !== -1) {
                    mockTasks[taskIndex].status = 'Completed';
                    activeTaskId = null; // æ¸…ç©ºå½“å‰é€‰ä¸­
                    initialMessage.classList.remove('hidden'); // æ˜¾ç¤ºåˆå§‹æç¤º
                    taskDataView.classList.add('hidden'); // éšè—è¯¦æƒ…
                    renderTaskList(); // é‡æ–°æ¸²æŸ“åˆ—è¡¨
                 }
             }
        }
    </script>
</body>
</html>
